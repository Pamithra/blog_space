<?php require_once __DIR__ . '/../inc/config.php'; require_once __DIR__ . '/../inc/db.php'; require_once __DIR__ . '/../inc/helpers.php'; if ($_SERVER['REQUEST_METHOD'] === 'POST'){ if (!csrf_verify($_POST['_csrf'] ?? '')){ $_SESSION['flash']='Invalid'; header('Location: '.BASE_URL.'auth/login.php'); exit; } $u = trim($_POST['username'] ?? ''); $p = $_POST['password'] ?? ''; $s = $pdo->prepare('SELECT * FROM user WHERE username=:u OR email=:u LIMIT 1'); $s->execute([':u'=>$u]); $user = $s->fetch(); if ($user && password_verify($p, $user['password'])){ $_SESSION['user']=['id'=>$user['id'],'username'=>$user['username'],'email'=>$user['email'],'role'=>$user['role'],'profile_image'=>$user['profile_image']]; $_SESSION['flash']='Welcome '.$user['username']; header('Location: '.BASE_URL); exit; } else { $_SESSION['flash']='Invalid credentials'; header('Location: '.BASE_URL.'auth/login.php'); exit; } } require_once __DIR__ . '/../inc/header.php'; ?><h1>Login</h1><form method="post" class="form"><input type="hidden" name="_csrf" value="<?php echo csrf_token(); ?>"><label>Username or email <input name="username" required></label><label>Password <input name="password" type="password" required></label><button type="submit">Login</button></form><?php require_once __DIR__ . '/../inc/footer.php'; ?>