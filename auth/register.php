<?php require_once __DIR__ . '/../inc/config.php'; require_once __DIR__ . '/../inc/db.php'; require_once __DIR__ . '/../inc/helpers.php'; if ($_SERVER['REQUEST_METHOD'] === 'POST'){ if (!csrf_verify($_POST['_csrf'] ?? '')){ $_SESSION['flash']='Invalid'; header('Location: '.BASE_URL.'auth/register.php'); exit; } $u = trim($_POST['username'] ?? ''); $e = trim($_POST['email'] ?? ''); $p = $_POST['password'] ?? ''; $p2 = $_POST['password2'] ?? ''; if (!$u || !$e || !$p){ $_SESSION['flash']='All fields required'; header('Location: '.BASE_URL.'auth/register.php'); exit; } if ($p !== $p2){ $_SESSION['flash']='Passwords do not match'; header('Location: '.BASE_URL.'auth/register.php'); exit; } $s = $pdo->prepare('SELECT id FROM user WHERE username=:u OR email=:e'); $s->execute([':u'=>$u,':e'=>$e]); if ($s->fetch()){ $_SESSION['flash']='Taken'; header('Location: '.BASE_URL.'auth/register.php'); exit; } $hash = password_hash($p, PASSWORD_DEFAULT); $ins = $pdo->prepare('INSERT INTO user (username,email,password) VALUES (:u,:e,:p)'); $ins->execute([':u'=>$u,':e'=>$e,':p'=>$hash]); $_SESSION['flash']='Registered'; header('Location: '.BASE_URL.'auth/login.php'); exit; } require_once __DIR__ . '/../inc/header.php'; ?><h1>Register</h1><form method="post" class="form"><input type="hidden" name="_csrf" value="<?php echo csrf_token(); ?>"><label>Username <input name="username" required></label><label>Email <input name="email" type="email" required></label><label>Password <input name="password" type="password" required></label><label>Confirm <input name="password2" type="password" required></label><button type="submit">Register</button></form><?php require_once __DIR__ . '/../inc/footer.php'; ?>